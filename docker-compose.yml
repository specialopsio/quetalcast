version: "3.8"

services:
  signaling:
    build: ./server
    ports:
      - "3001:3001"
    volumes:
      - ./server/logs:/app/logs
    environment:
      - PORT=3001
      - ALLOWED_ORIGIN=*
      - REQUIRE_TLS=false
      - LOG_LEVEL=info
    restart: unless-stopped

  # Optional: TURN server for NAT traversal
  # Uncomment to enable coturn
  # coturn:
  #   image: coturn/coturn:latest
  #   ports:
  #     - "3478:3478"
  #     - "3478:3478/udp"
  #     - "5349:5349"
  #     - "5349:5349/udp"
  #     - "49152-49200:49152-49200/udp"
  #   volumes:
  #     - ./turnserver.conf:/etc/coturn/turnserver.conf
  #   restart: unless-stopped

  # Optional: Caddy reverse proxy for TLS termination
  # Uncomment for production HTTPS
  # caddy:
  #   image: caddy:2-alpine
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #   volumes:
  #     - ./Caddyfile:/etc/caddy/Caddyfile
  #     - caddy_data:/data
  #     - caddy_config:/config
  #   depends_on:
  #     - signaling
  #   restart: unless-stopped

# volumes:
#   caddy_data:
#   caddy_config:
